#!/bin/bash
if ! command -v ansible-doc; then
    echo "ansible-doc not found, maybe source your venv?!"
    exit 1
fi

export ANSIBLE_FORCE_COLOR="True"

selected=`ansible-doc --list -j 2> /dev/null | jq 'keys[]' | sed 's/"//g' | fzf`
docs_command="ansible-doc $selected \"$@\""

echo "Selected: $selected"

if ! [ -z "$TMUX" ]; then
    tmux neww -n "$selected" bash -c "PATH=$PATH $docs_command | vim -c 'set syntax=yaml' -R -"
else
    eval $docs_command | vim -c 'set syntax=yaml' -R -
fi

